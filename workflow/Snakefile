import pandas as pd
import yaml

configfile: "config/config.yaml"

#-----------------------------------------------------------------------------------------------------------------------
# Load sample sheet and cluster configuration, config file
#-----------------------------------------------------------------------------------------------------------------------
units       = pd.read_csv(config["units"], dtype=str, sep="\t").set_index(["sample_id", "feature_bc", "lane"], drop=False).sort_index()
units.index = units.index.set_levels([i.astype(str) for i in units.index.levels])  # enforce str in index

SAMPLES      = set(units["sample_id"])
RESOURCES    = yaml.load(open(config['resources'], 'r'), Loader=yaml.FullLoader)
LARRY_COLORS = [color for color in config["feature_bc_config"]["bc_patterns"].values()]

include: "rules/common.smk"
include: "rules/resources.smk"
include: "rules/counts.smk"
include: "rules/larry_processing.smk"

rule all:
    input:
        # "data/clean/CTR-rep1_FB_S1_L001_R1_001.fastq.gz",
        # "data/feature_reference/Feature_reference.csv"
        expand("results/01_counts/{sample}/outs/filtered_feature_bc_matrix/matrix.mtx.gz", sample = SAMPLES)
